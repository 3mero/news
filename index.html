<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ูุดุบู ุงููููุงุช ูุงูููุฏูู ูุงูุตูุชูุงุช</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.plyr.io/3.6.8/plyr.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.plyr.io/3.6.8/plyr.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
  <script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
  <style>
/* ุงุณุชุงูู ุงูุฌุณู ุงูุนุงู */
body {
  font-family: Arial, sans-serif;
  background-color: #f8f9fa;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  line-height: 1.6;
  font-size: 19px;
  color: #333;
  max-width: 100%;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ุงุณุชุงูู ุงูุญุงููุฉ ุงูุฑุฆูุณูุฉ */
.container {
  max-width: 1500px;
  margin: 0 auto;
  padding: 20px;
  background-color: #71706e;
}

/* ุงุณุชุงูู ุงูุนูุงููู */
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  line-height: 1.2;
}

/* ุงุณุชุงูู ุงูููุฑุงุช */
p {
  margin: 0 0 1em;
}

/* ุงุณุชุงูู ุงูุฑูุงุจุท */
a {
  color: #007bff;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* ุงุณุชุงูู ุงูุฃุฒุฑุงุฑ ุงูุนุงูุฉ */
button {
  font-family: inherit;
  font-size: inherit;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
  color: #fff;
}

/* ุงุณุชุงูู ุงูุตูุฑ */
img {
  max-width: 100%;
  height: auto;
}

/* ุงุณุชุงูู ุงูุนููุงู */
.title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 60px;
  text-align: center;
  position: relative;
}

/* ุงุณุชุงูู ุชูุฒูู ุงูุตูุญุฉ */
.download-page {
  position: absolute;
  right: 20px;
  top: 0;
}

/* ุงุณุชุงูู ุฅุทุงุฑ ุงููุญุชูู */
.content-frame {
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 8px;
  background-color: #36454F;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  position: relative;
}

/* ุงุณุชุงูู ุญุงููุฉ ุงูููุฏูู */
.video-container {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
}

/* ุงุณุชุงูู ูุดุบู ุงูููุฏูู */
.plyr__video-embed {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* ุงุณุชุงูู ุงูููุฏููุ ุงูุตูุชุ ู ุงูุฅุทุงุฑุงุช */
video, audio, iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* ุงุณุชุงูู ุดุฑูุท ุงูุชุญูู */
.controls-bar {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}

.controls-bar button {
  margin: 0 5px;
}

/* ุงุณุชุงูู ุนูุตุฑ ูุงุฆูุฉ ุงูุชุดุบูู */
.playlist-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #ccc;
}

.playlist-item:last-child {
  border-bottom: none;
}

/* ุงุณุชุงูู ุงูุฃููููุงุช */
.edit-icon, .delete-icon, .add-icon {
  cursor: pointer;
  margin-left: 10px;
}

.edit-icon:hover, .delete-icon:hover, .add-icon:hover {
  color: #007bff;
}

/* ุงุณุชุงูู ุงููุถุน ุงูุฏุงูู */
.dark-mode {
  background-color: #333;
  color: #fff;
}

/* ุงุณุชุงูู ุงูุฑุงุจุท ุงููุฎูู */
.hidden-link {
  display: none;
}

/* ุงุณุชุงูู ุฒุฑ ุงููุงุฆูุฉ ุงูููุณุฏูุฉ */
.dropdown-toggle {
  color: #6c757d;
}

/* ุงุณุชุงูู ุฅุฌูุงูู ุงูุฑูุงุจุท */
#total-links {
  color: red;
}

/* ุงุณุชุงูู ุญุงููุฉ ุงูุจุญุซ */
#search-container {
  position: absolute;
  top: -60px;
  right: 0;
  display: flex;
  align-items: center;
}

#search-container input {
  margin-right: 10px;
}

/* ุงุณุชุงูู ุญุฐู ุงููู */
#clear-all {
  cursor: pointer;
  font-size: 20px;
  color: red;
}

/* ุงุณุชุงูู ูุงุฆูุฉ ุงูุชุดุบูู */
#playlist {
  max-height: 400px;
  overflow-y: auto;
}

/* ุงุณุชุงูู ุนูุงุตุฑ ุงููููุงุช */
.channel-item {
  margin-bottom: 5px;
}

/* ุงุณุชุงูู ูุญุชูู ุงููููุงุช */
.channel-content {
  display: none;
  margin-left: 20px;
}

.channel-content .list-group-item {
  padding: 5px 15px;
}

/* ุงุณุชุงูู ูุต ุงูููุชุฑ */
#footer-text {
  position: fixed;
  bottom: 0;
  width: 100%;
  background-color: #333;
  color: #fff;
  text-align: center;
  padding: 10px;
  font-size: 16px;
  transition: all 0.5s ease-in-out;
}

#footer-text:hover {
  opacity: 0;
  transform: translateY(20px);
}

        #channelList .list-group-item-action {
            background-color: #007bff; /* ุงูููู ุงูุฃุณุงุณู ููุฎูููุฉ */
            color: white; /* ููู ุงููุต ุฏุงุฎู ุงูุฒุฑ */
        }

        #channelList .list-group-item-action:hover {
            background-color: #0056b3; /* ุงูููู ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุงูุฒุฑ */
        }

        /* ุฃููุงุท ุงูุฃุฒุฑุงุฑ ูู ูุงุฆูุฉ ุงูุชุดุบูู ุงููุงููุฉ */
        #playlist .list-group-item-action {
            background-color: #28a745; /* ุงูููู ุงูุฃุณุงุณู ููุฎูููุฉ */
            color: white; /* ููู ุงููุต ุฏุงุฎู ุงูุฒุฑ */
        }

        #playlist .list-group-item-action:hover {
            background-color: #218838; /* ุงูููู ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุงูุฒุฑ */
        }

/* ุชุฎุตูุต ุงูุฎุทูุท */
.custom-font {
  font-family: 'Arial', sans-serif;
  color: #333;
}

/* ุชุฎุตูุต ุงูุฃุฒุฑุงุฑ */
.custom-bg-button {
  background-color: #ff6347; /* ุงูููู ุงูุฃุณุงุณู ููุฎูููุฉ */
  color: white; /* ููู ุงููุต ุฏุงุฎู ุงูุฒุฑ */
}

.custom-bg-button:hover {
  background-color: #ff4500; /* ุงูููู ุนูุฏ ุงูุชูุฑูุฑ ุนูู ุงูุฒุฑ */
}

/* ุชุฎุตูุต ุงูููุฏุงู */
.modal-content {
  background-color: #333; /* ููู ุฏุงูู ูุฎูููุฉ ุงูููุฏุงู */
  color: white; /* ููู ุงููุต ุฏุงุฎู ุงูููุฏุงู */
}

    
  </style>
</head>
<body>
  <div class="container mt-4">
    <div class="title">
      ูุดุบู ุงููููุงุช ูุงูุฑูุงุจุท
    </div>
          <button class="btn btn-secondary download-page" onclick="downloadPage()">ุชูุฒูู ุงูุตูุญุฉ</button>
    <div class="content-frame">
      <div id="search-container">
        <input type="text" id="searchInput" class="form-control" placeholder="ุจุญุซ ุนู ููุงุฉ">
        <div id="clear-all">ุญุฐู ุงูููX</div>
      </div>
      <div class="lightbulb" onclick="toggleDarkMode()">๐/โ๏ธ</div>
      <div class="row">
        <div class="col-12 col-md-8">
          <div class="video-container">
            <video id="video" controls></video>
            <audio id="audio" controls style="display: none;"></audio>
            <iframe id="youtube" style="display: none;" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <div class="controls-bar mt-2">
            <button class="btn btn-primary" onclick="refreshPage()">ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ</button>
            <button class="btn btn-primary" onclick="rewindVideo()">ููุฎูู 15 ุซุงููุฉ</button>
            <button class="btn btn-primary" onclick="toggleVideo()">ุชุดุบูู/ุฅููุงู</button>
            <button class="btn btn-primary" onclick="forwardVideo()">ุชูุฏูู 15 ุซุงููุฉ</button>
            <button class="btn btn-primary" onclick="setZoom(100)">ุชูุจูุฑ</button>
            <button class="btn btn-primary" onclick="setZoom(75)">ุชุตุบูุฑ</button>
            <button class="btn btn-secondary" data-toggle="modal" data-target="#editModal">ุฃููุงู ููุญุชููุงุช ุงูุตูุญุฉ</button>
          </div>
        </div>
        <div class="col-12 col-md-4 mt-4 mt-md-0">
          <div class="card mb-3">
            <div class="card-header bg-primary text-white">
              ูุงุฆูุฉ ุงููููุงุช
            </div>
            <div id="channelList" class="list-group list-group-flush">
              <!-- ุณูุชู ุฅุถุงูุฉ ุฃุณูุงุก ุงููููุงุช ููุง -->
            </div>
          </div>
          <button class="btn btn-secondary mt-2" onclick="togglePlaylist()">ุฅุธูุงุฑ/ุฅุฎูุงุก ูุงุฆูุฉ ุงูุชุดุบูู ุงููุงููุฉ</button>
          <div id="fullPlaylist" style="display:none;">
            <div class="card mt-3">
              <div class="card-header bg-primary text-white">
                ูุงุฆูุฉ ุงูุชุดุบูู ุงููุงููุฉ
              </div>
              <div id="playlist" class="playlist list-group list-group-flush">
                <!-- ุนูุงุตุฑ ูุงุฆูุฉ ุงูุชุดุบูู ุงููุงููุฉ ุณุชุจูู ููุง -->
              </div>
            </div>
            <button class="btn btn-primary mt-2" onclick="addChannel()">ุฅุถุงูุฉ ููุงุฉ</button>
            <button class="btn btn-success mt-2" onclick="savePlaylistToFile()">ุญูุธ ูุงุฆูุฉ ุงูุชุดุบูู</button>
            <input type="file" id="playlistFileInput" accept=".json,.m3u,.m3u8" onchange="loadPlaylistFromFile(event)" style="display: none;">
            <button class="btn btn-info mt-2" onclick="document.getElementById('playlistFileInput').click();">ุฅุฑูุงู ููู ุชุดุบูู json + m3u/m3u8</button>
            <input type="text" id="playlistUrlInput" class="form-control mt-2" placeholder="json ุฃุฏุฎู ุฑุงุจุท ุงูุชุดุบูู ุจุตูุบุฉ">
            <button class="btn btn-warning mt-2" onclick="loadPlaylistFromUrl()">ุชุญููู ูุงุฆูุฉ ุงูุชุดุบูู ูู ุงูุฑุงุจุท</button>
            <div id="total-links" class="mt-2 text-center">ูุฌููุน ุงูุฑูุงุจุท: 0</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-text">
By Omar K H
  </div>
<!-- Modal for editing elements -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">ุฃููุงู ููุญุชููุงุช ุงูุตูุญุฉ</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="editElementsContainer">
          <!-- ุฅุถุงูุฉ ูุฐุง ุงูุฌุฒุก -->
          <div class="form-group">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">ุฅุบูุงู</button>
      </div>
    </div>
  </div>
</div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
  <script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>

var video = document.getElementById('video');
var audio = document.getElementById('audio');
var youtube = document.getElementById('youtube');
var isPlaying = false;

function refreshPage() {
  location.reload();
}

function rewindVideo() {
  if (video.style.display !== 'none') {
    video.currentTime -= 15;
  } else if (audio.style.display !== 'none') {
    audio.currentTime -= 15;
  } else {
    console.log("Cannot rewind YouTube videos");
  }
}

function forwardVideo() {
  if (video.style.display !== 'none') {
    video.currentTime += 15;
  } else if (audio.style.display !== 'none') {
    audio.currentTime += 15;
  } else {
    console.log("Cannot forward YouTube videos");
  }
}

function toggleVideo() {
  if (isPlaying) {
    if (video.style.display !== 'none') {
      video.pause();
    } else if (audio.style.display !== 'none') {
      audio.pause();
    } else {
      youtube.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
    }
  } else {
    if (video.style.display !== 'none') {
      video.play();
    } else if (audio.style.display !== 'none') {
      audio.play();
    } else {
      youtube.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
    }
  }
  isPlaying = !isPlaying;
}

function setZoom(zoom) {
  document.body.style.zoom = zoom + '%';
}

function playVideo(src) {
  var extension = src.split('.').pop().toLowerCase();
  console.log("Playing video with src: " + src + " and extension: " + extension);
  if (extension === 'm3u8') {
    if (Hls.isSupported()) {
      var hls = new Hls();
      hls.loadSource(src);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, function () {
        video.style.display = 'block';
        audio.style.display = 'none';
        youtube.style.display = 'none';
        video.play();
        isPlaying = true;
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = src;
      video.addEventListener('loadedmetadata', function () {
        video.style.display = 'block';
        audio.style.display = 'none';
        youtube.style.display = 'none';
        video.play();
        isPlaying = true;
      });
    }
  } else if (['mp4', 'webm', 'ogg'].includes(extension)) {
    video.src = src;
    video.addEventListener('loadedmetadata', function () {
      video.style.display = 'block';
      audio.style.display = 'none';
      youtube.style.display = 'none';
      video.play();
      isPlaying = true;
    });
  } else if (['mp3', 'wav', 'ogg'].includes(extension)) {
    audio.src = src;
    video.style.display = 'none';
    audio.style.display = 'block';
    youtube.style.display = 'none';
    audio.play();
    isPlaying = true;
  } else if (src.includes('youtube.com') || src.includes('youtu.be')) {
    var videoId = src.split('v=')[1] || src.split('/').pop();
    youtube.src = "https://www.youtube.com/embed/" + videoId + "?enablejsapi=1";
    video.style.display = 'none';
    audio.style.display = 'none';
    youtube.style.display = 'block';
  } else {
    console.error("Unsupported file extension: " + extension);
  }
}

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

function deleteChannel(element) {
  if (confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู ูุฐู ุงูููุงุฉุ')) {
    var item = element.closest('.playlist-item');
    item.remove();
    savePlaylist();
    updateTotalLinks();
  }
}

function editLink(element) {
  var linkItem = element.closest('.list-group-item');
  var newLink = prompt('ุฃุฏุฎู ุงูุฑุงุจุท ุงูุฌุฏูุฏ:', linkItem.querySelector('.hidden-link').innerText);
  if (newLink) {
    linkItem.querySelector('.hidden-link').innerText = newLink;
    linkItem.setAttribute('onclick', `playVideo('${newLink}')`);
    savePlaylist();
  }
}

function editLinkName(element) {
  var linkItem = element.closest('.list-group-item');
  var newLinkName = prompt('ุฃุฏุฎู ุงุณู ุงูุฑุงุจุท ุงูุฌุฏูุฏ:', linkItem.querySelector('.link-name').innerText);
  if (newLinkName) {
    linkItem.querySelector('.link-name').innerText = newLinkName;
    savePlaylist();
  }
}

function editChannelName(element) {
  var item = element.closest('.playlist-item');
  var newName = prompt('ุฃุฏุฎู ุงุณู ุงูููุงุฉ ุงูุฌุฏูุฏ:', item.getAttribute('data-channel'));
  if (newName) {
    var channelLink = item.querySelector('.dropdown-toggle');
    channelLink.innerText = newName;
    item.setAttribute('data-channel', newName);
    var channelList = item.querySelector('.collapse');
    channelList.id = newName + '-list';
    channelLink.setAttribute('data-target', '#' + newName + '-list');
    savePlaylist();
  }
}

function addLink(element) {
  var item = element.closest('.playlist-item');
  var channelName = item.getAttribute('data-channel');
  var newLink = prompt('ุฃุฏุฎู ุงูุฑุงุจุท ุงูุฌุฏูุฏ:');
  var newLinkName = prompt('ุฃุฏุฎู ุงุณู ููุฑุงุจุท ุงู ุงูุฌูุฏุฉ:');
  if (newLink && newLinkName) {
    var newLinkItem = document.createElement('a');
    newLinkItem.href = '#';
    newLinkItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
    newLinkItem.innerHTML = `
      <span class="link-name">${newLinkName}</span>
      <span class="hidden-link">${newLink}</span>
      <div>
        <div class="edit-icon" onclick="editLinkName(this)">๐๏ธ</div>
        <div class="edit-icon" onclick="editLink(this)">๐๏ธ</div>
        <div class="delete-icon" onclick="deleteLink(this)">โ</div>
      </div>
    `;
    newLinkItem.setAttribute('onclick', `playVideo('${newLink}')`);
    item.querySelector('.collapse').appendChild(newLinkItem);
    savePlaylist();
    updateTotalLinks();
  }
}

function deleteLink(element) {
  if (confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุฑุงุจุทุ')) {
    var linkItem = element.closest('.list-group-item');
    linkItem.remove();
    savePlaylist();
    updateTotalLinks();
  }
}

function addChannel() {
  var newChannelName = prompt('ุฃุฏุฎู ุงุณู ุงูููุงุฉ ุงูุฌุฏูุฏุฉ:');
  if (newChannelName) {
    var newChannel = document.createElement('div');
    newChannel.classList.add('playlist-item');
    newChannel.setAttribute('data-channel', newChannelName);
    var newChannelId = 'channel-' + new Date().getTime();
    newChannel.innerHTML = `
      <div style="flex-grow: 1;">
        <a href="#" class="dropdown-toggle collapsed" data-toggle="collapse" data-target="#${newChannelId}-list" aria-expanded="false">
          ${newChannelName} (0 ุฑูุงุจุท)
        </a>
      </div>
      <div>
        <div class="edit-icon" onclick="editChannelName(this)">โ๏ธ</div>
        <div class="add-icon" onclick="addLink(this)">โ</div>
        <div class="delete-icon" onclick="deleteChannel(this)">โ</div>
      </div>
      <div class="collapse" id="${newChannelId}-list">
        <!-- ุงูุฑูุงุจุท ุณูุชู ุฅุถุงูุชูุง ููุง -->
      </div>
    `;
    document.getElementById('playlist').appendChild(newChannel);
    savePlaylist();
  }
}

function savePlaylist() {
  var playlist = [];
  document.querySelectorAll('.playlist-item').forEach(function (item) {
    var channel = {
      name: item.getAttribute('data-channel'),
      links: []
    };
    item.querySelectorAll('.list-group-item').forEach(function (linkItem) {
      channel.links.push({
        name: linkItem.querySelector('.link-name').innerText,
        url: linkItem.querySelector('.hidden-link').innerText
      });
    });
    playlist.push(channel);
  });
  localStorage.setItem('playlist', JSON.stringify(playlist));
  updateTotalLinks();
  loadPlaylist(); // Refresh the channel list
}

function savePlaylistToFile() {
  var playlist = localStorage.getItem('playlist');
  var blob = new Blob([playlist], { type: 'application/json' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  var fileName = prompt('ุฃุฏุฎู ุงุณู ููู ุงูุชุดุบูู:', 'playlist.json');
  if (fileName) {
    a.href = url;
    a.download = fileName;
    a.click();
    URL.revokeObjectURL(url);
  }
}

function loadPlaylistFromFile(event) {
  var file = event.target.files[0];
  var reader = new FileReader();
  reader.onload = function (e) {
    var content = e.target.result;
    if (file.name.endsWith('.json')) {
      localStorage.setItem('playlist', content);
      loadPlaylist();
    } else if (file.name.endsWith('.m3u') || file.name.endsWith('.m3u8')) {
      parseM3U(content);
    }
  };
  reader.readAsText(file);
}

function loadPlaylistFromUrl() {
  var url = document.getElementById('playlistUrlInput').value;
  fetch(url)
    .then(response => response.text())
    .then(data => {
      if (url.endsWith('.json')) {
        localStorage.setItem('playlist', data);
        loadPlaylist();
      } else if (url.endsWith('.m3u') || url.endsWith('.m3u8')) {
        parseM3U(data);
      }
    })
    .catch(error => console.error('Error loading playlist:', error));
}

function parseM3U(content) {
  var lines = content.split('\n');
  var playlist = [];
  var currentChannel = null;

  lines.forEach(line => {
    line = line.trim();
    if (line.startsWith('#EXTINF:')) {
      var channelInfo = line.split(',')[1];
      if (currentChannel && currentChannel.links.length > 0) {
        playlist.push(currentChannel);
      }
      currentChannel = {
        name: channelInfo,
        links: []
      };
    } else if (line && !line.startsWith('#') && currentChannel) {
      currentChannel.links.push({
        name: 'Link ' + (currentChannel.links.length + 1),
        url: line
      });
    }
  });

  if (currentChannel && currentChannel.links.length > 0) {
    playlist.push(currentChannel);
  }

  var existingPlaylist = JSON.parse(localStorage.getItem('playlist') || '[]');
  playlist = existingPlaylist.concat(playlist);
  localStorage.setItem('playlist', JSON.stringify(playlist));
  loadPlaylist();
}

function loadPlaylist() {
  var playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
  var channelList = document.getElementById('channelList');
  var fullPlaylist = document.getElementById('playlist');
  
  channelList.innerHTML = '';
  fullPlaylist.innerHTML = '';
  
  playlist.forEach(function (channel, index) {
    // ุฅุถุงูุฉ ุงูููุงุฉ ุฅูู ูุงุฆูุฉ ุงููููุงุช
    var channelItem = document.createElement('div');
    channelItem.classList.add('channel-item');
    
    var channelHeader = document.createElement('a');
    channelHeader.href = '#';
    channelHeader.classList.add('list-group-item', 'list-group-item-action');
    channelHeader.innerText = channel.name;
    channelHeader.onclick = function(e) { 
      e.preventDefault();
      toggleChannelExpand(this);
    };
    channelItem.appendChild(channelHeader);
    
    var channelContent = document.createElement('div');
    channelContent.classList.add('channel-content', 'collapse');
    
    channel.links.forEach(function(link, linkIndex) {
      var linkItem = document.createElement('a');
      linkItem.href = '#';
      linkItem.classList.add('list-group-item', 'list-group-item-action', 'pl-4');
      linkItem.innerText = link.name;
      linkItem.onclick = function() { playVideo(link.url); };
      channelContent.appendChild(linkItem);
    });
    
    channelItem.appendChild(channelContent);
    channelList.appendChild(channelItem);
    
    // ุฅุถุงูุฉ ุงูููุงุฉ ุฅูู ูุงุฆูุฉ ุงูุชุดุบูู ุงููุงููุฉ
    var newChannel = document.createElement('div');
    newChannel.classList.add('playlist-item');
    newChannel.setAttribute('data-channel', channel.name);
    var newChannelId = 'channel-' + index;
    newChannel.innerHTML = `
      <div style="flex-grow: 1;">
        <a href="#" class="dropdown-toggle collapsed" data-toggle="collapse" data-target="#${newChannelId}-list" aria-expanded="false">
          ${channel.name} (${channel.links.length} ุฑูุงุจุท)
        </a>
      </div>
      <div>
        <div class="edit-icon" onclick="editChannelName(this)">โ๏ธ</div>
        <div class="add-icon" onclick="addLink(this)">โ</div>
        <div class="delete-icon" onclick="deleteChannel(this)">โ</div>
      </div>
      <div class="collapse" id="${newChannelId}-list">
${channel.links.map(link => `
        <a href="#" class="list-group-item d-flex justify-content-between align-items-center" onclick="playVideo('${link.url}')">
          <span class="link-name">${link.name}</span>
          <span class="hidden-link">${link.url}</span>
          <div>
            <div class="edit-icon" onclick="editLinkName(this)">๐๏ธ</div>
            <div class="edit-icon" onclick="editLink(this)">๐๏ธ</div>
            <div class="delete-icon" onclick="deleteLink(this)">โ</div>
          </div>
        </a>
      `).join('')}
      </div>
    `;
    fullPlaylist.appendChild(newChannel);
  });
  updateTotalLinks();
}

function toggleChannelExpand(element) {
  var content = element.nextElementSibling;
  if (content.style.display === "block") {
    content.style.display = "none";
  } else {
    content.style.display = "block";
  }
}

function playFirstLink(channelIndex) {
  var playlist = JSON.parse(localStorage.getItem('playlist') || '[]');
  if (playlist[channelIndex] && playlist[channelIndex].links.length > 0) {
    playVideo(playlist[channelIndex].links[0].url);
  }
}

function togglePlaylist() {
  var fullPlaylist = document.getElementById('fullPlaylist');
  if (fullPlaylist.style.display === 'none') {
    fullPlaylist.style.display = 'block';
  } else {
    fullPlaylist.style.display = 'none';
  }
}

function updateTotalLinks() {
  var totalLinks = 0;
  document.querySelectorAll('.playlist-item .list-group-item').forEach(function () {
    totalLinks++;
  });
  document.getElementById('total-links').innerText = 'ูุฌููุน ุงูุฑูุงุจุท: ' + totalLinks;
}

function clearAllChannels() {
  if (confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู ุฌููุน ุงููููุงุชุ')) {
    localStorage.removeItem('playlist');
    loadPlaylist();
  }
}

function filterChannels() {
  var input = document.getElementById('searchInput');
  var filter = input.value.toLowerCase();
  
  // Filter channels in the channel list
  var channelItems = document.querySelectorAll('#channelList .channel-item');
  channelItems.forEach(function(channel) {
    var channelName = channel.querySelector('.list-group-item').innerText.toLowerCase();
    var links = channel.querySelectorAll('.channel-content .list-group-item');
    var linkMatch = false;
    links.forEach(function(link) {
      var linkName = link.innerText.toLowerCase();
      if (linkName.indexOf(filter) > -1) {
        link.style.display = '';
        linkMatch = true;
      } else {
        link.style.display = 'none';
      }
    });
    if (channelName.indexOf(filter) > -1 || linkMatch) {
      channel.style.display = '';
    } else {
      channel.style.display = 'none';
    }
  });

  // Filter channels in the full playlist
  var playlistItems = document.querySelectorAll('#playlist .playlist-item');
  playlistItems.forEach(function(channel) {
    var channelName = channel.querySelector('.dropdown-toggle').innerText.toLowerCase();
    var links = channel.querySelectorAll('.list-group-item');
    var linkMatch = false;
    links.forEach(function(link) {
      var linkName = link.querySelector('.link-name').innerText.toLowerCase();
      if (linkName.indexOf(filter) > -1) {
        link.style.display = '';
        linkMatch = true;
      } else {
        link.style.display = 'none';
      }
    });
    if (channelName.indexOf(filter) > -1 || linkMatch) {
      channel.style.display = '';
    } else {
      channel.style.display = 'none';
    }
  });
}

function downloadPage() {
  var htmlContent = document.documentElement.outerHTML;
  var blob = new Blob([htmlContent], { type: 'text/html' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  var fileName = prompt('ุฃุฏุฎู ุงุณู ุงูููู:', 'page.html');
  if (fileName) {
    a.href = url;
    a.download = fileName;
    a.click();
    URL.revokeObjectURL(url);
  }
}

function populateEditModal() {
  var elements = document.querySelectorAll('button, .card-header, .list-group-item, .title, #footer-text');
  var container = document.getElementById('editElementsContainer');
  container.innerHTML = '';
  elements.forEach(function(element, index) {
    var elementType = element.tagName.toLowerCase();
    var elementContent = element.innerText.trim() || element.getAttribute('placeholder') || 'ูุญุชูู ุบูุฑ ูุชููุฑ';
    var elementId = `edit-element-${index}`;
    var colorId = `color-element-${index}`;
    var bgColorId = `bgcolor-element-${index}`;
    var saveButtonId = `save-button-${index}`;
    container.innerHTML += `
      <div class="form-group">
        <label for="${elementId}">${elementType}: ${elementContent}</label>
        <input type="text" class="form-control mb-2" id="${elementId}" value="${elementContent}">
        <label for="${colorId}">ุชุบููุฑ ููู ุงูุฎุท:</label>
        <input type="color" class="form-control" id="${colorId}" value="#000000">
        <label for="${bgColorId}">ุชุบููุฑ ููู ุงูุฎูููุฉ:</label>
        <input type="color" class="form-control" id="${bgColorId}" value="#ffffff">
        <button class="btn btn-primary mt-2" id="${saveButtonId}" onclick="saveElementChanges('${index}')">ุญูุธ ุงูุชุบููุฑุงุช</button>
      </div>
    `;
    element.dataset.editId = elementId;
    element.dataset.colorId = colorId;
    element.dataset.bgColorId = bgColorId;
    element.dataset.saveButtonId = saveButtonId;
  });
}

function saveElementChanges(index) {
  var element = document.querySelector(`[data-edit-id="edit-element-${index}"]`);
  var editId = element.dataset.editId;
  var colorId = element.dataset.colorId;
  var bgColorId = element.dataset.bgColorId;
  var newText = document.getElementById(editId).value;
  var newColor = document.getElementById(colorId).value;
  var newBgColor = document.getElementById(bgColorId).value;

  element.innerText = newText;
  element.style.color = newColor;
  element.style.backgroundColor = newBgColor;

  var savedElements = JSON.parse(localStorage.getItem('savedElements') || '[]');
  savedElements[index] = {
    text: newText,
    color: newColor,
    bgColor: newBgColor,
  };
  localStorage.setItem('savedElements', JSON.stringify(savedElements));

  $('#editModal').modal('hide');
}

function applySavedChanges() {
  var savedElements = JSON.parse(localStorage.getItem('savedElements') || '[]');
  savedElements.forEach(function(savedElement, index) {
    var element = document.querySelector(`[data-edit-id="edit-element-${index}"]`);
    if (element) {
      element.innerText = savedElement.text;
      element.style.color = savedElement.color;
      element.style.backgroundColor = savedElement.bgColor;
    }
  });
}
  
 

document.addEventListener('DOMContentLoaded', function () {
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }
  loadPlaylist();
  populateEditModal();
  applySavedChanges();
  document.getElementById('searchInput').addEventListener('keyup', filterChannels);
  document.getElementById('clear-all').addEventListener('click', clearAllChannels);
});
</script>
</body>
</html>
